< [Back](PenTesting.md)
# Info gathering
This phase tries to understand and scope the targets to be engaged.
```
export DOMAIN_NAME=foo.com 
export IP_FILE_LIST=MyIpList.txt
```
# Observe
The act of capture information to help understand (**Orient**) the scape. It's important to organize it and/or make it searchable.  
**Personal take**: I capture raw output of tools and save it. I also use tables/spreadsheet as method to start sorting and filtering info.

## Passive info gathering
The goal is to identify targets by indirect means to minimize the chance of detection. It uses publicly available information and gatherers to start to build a picture of what is available and what it can be potentially used in the engagement.

**WHOIS Command**
```
whois $DOMAIN_NAME
```

**Google Dorking**  
Many more examples can be found at [Google Hacking DB](https://www.exploit-db.com/google-hacking-database)
```
site:<domain> -site:<already ID site(s)>
site:<site> filetype:ppt
site:<site> filetype:axd
site:<site> filetype:cnf
site:<site> intitle:"VNC viewer for Java"
site:<site> inurl:"control/userimage.html"
```
**The Harvester**
Use help to find even more sources of data. Some examples below.  
```
theharvester $DOMAIN_NAME -b google
theharvester $DOMAIN_NAME -b bing
theharvester $DOMAIN_NAME -b yahoo
theharvester $DOMAIN_NAME -b baidu
theharvester $DOMAIN_NAME -b Censys
theharvester $DOMAIN_NAME -b Linkedin
```
## Active Info Gathering - Infrastructure

**DNS Queries**
```
host -t ns $DOMAIN_NAME
host -t mx $DOMAIN_NAME
```
**DNS Guesses**
```
host www.$DOMAIN_NAME
host www2.$DOMAIN_NAME
host ftp.$DOMAIN_NAME
host mail.$DOMAIN_NAME
host mail2.$DOMAIN_NAME
host admin.$DOMAIN_NAME
host admin.$DOMAIN_NAME
host ns.$DOMAIN_NAME
host pop3.$DOMAIN_NAME
host owa.$DOMAIN_NAME
```
**DNS Zone Transfer**
```
export $DNS_SERVER_NAME
host -l $DOMAIN_NAME $DNS_SERVER_NAME
```
**DNS Tool: DNS Recon**
```
dnsrecon -d $DOMAIN_NAME
```

## Active Info Gathering - Sweep
The very first level of active information gathering directed at devices themselves. 
The goal is to map devices quickly. 

**Ping Sweep**  
Using ping command:  
```
for i in ($IP_FILE_LIST)
do
   ping -c 1 $i | grep from | grep -v unreachable | cut -d " " -f 4 | cut -d ":" -f 1
done
```
Using nmap:
```
nmap -sn -iL $IP_FILE_LIST
```

**Nbtscan Sweep**  
```
nbtscan -f $IP_FILE_LIST
```

**TCP Sweep (FTP)**  
```
export TCPPORT=21  
nmap -n -iL $IP_FILE_LIST -p $TCPPORT -oG /tmp/nmapOut.txt > nul
cat /tmp/nmapOut.txt | grep Ports: | grep open | cut -d " " -f 2
```
**TCP Sweep (SSH)**  
```
export TCPPORT=22
nmap -n -iL $IP_FILE_LIST -p $TCPPORT -oG /tmp/nmapOut.txt > nul
cat /tmp/nmapOut.txt | grep Ports: | grep open | cut -d " " -f 2
```
**TCP Sweep (HTTP)**  
```
export TCPPORT=80
nmap -n -iL $IP_FILE_LIST -p $TCPPORT -oG /tmp/nmapOut.txt > nul
cat /tmp/nmapOut.txt | grep Ports: | grep open | cut -d " " -f 2
```
**TCP Sweep (HTTPS)**  
```
export TCPPORT=443
nmap -n -iL $IP_FILE_LIST -p $TCPPORT -oG /tmp/nmapOut.txt > nul
cat /tmp/nmapOut.txt | grep Ports: | grep open | cut -d " " -f 2
```
**UDP Sweep (DNS)**  
```
export UDPPORT=53
nmap -sU -n -iL $IP_FILE_LIST -p $UDPPORT -oG /tmp/udpPort.txt > nul
cat /tmp/udpPort.txt | grep open | grep -v filtered | cut -d " " -f 2
```
**UDP Sweep (SMNP)**  
```
export UDPPORT=161
nmap -sU -n -iL $IP_FILE_LIST -p $UDPPORT -oG /tmp/udpPort.txt > nul
cat /tmp/udpPort.txt | grep open | grep -v filtered | cut -d " " -f 2
```
Also,
```
export COMUNITY_FILE=/usr/share/cisco-torch/community.txt
onesixtyone -c $COMUNITY_FILE -i $IP_FILE_LIST
```
Another option
```
snmp-check $RHOST
```

**Reverse DNS recon**  
```
while read dns; do
   while read ip; do
      host $ip $dns | grep pointer
   done <$IP_FILE_LIST
done <$DNS_FILE_LIST
```

**DNS Zone Transfer recon**  
```
while read dns; do
   while read ip; do
      host -l $ip $dns | grep address
   done <$IP_FILE_LIST
done <$DNS_FILE_LIST'''
```
## Service Scan

**TCP Services**  
```
nmap -Pn -sV -sC -O --top-ports 5000 -n -scripts "discovery or version" $RHOST
```

## SQL Injection

Kali has a command-line tool that can interact with SQL databases. It is not installed by default.    
```
apt-get install sqsh freetds-bin freetds-common freetds-dev
```
For any database, make sure to update server info at  
```
/etc/freetds/freetds.conf
```
and authentication info at:
```
 ~/.sqshrc
 ```
 To connect to a SQL server:  
```
 sqsh -S ServerName
 ```


